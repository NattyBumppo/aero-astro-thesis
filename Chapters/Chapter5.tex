\chapter{Case Study: Hakuto ``Moonraker" Lunar Rover}

In this section, we will discuss a motivating problem and platform on which to test some of the algorithms we've developed and assess their practicality.

\section{HAKUTO Lunar XPRIZE Team}

In the summer and autumn of 2015, research was performed at Tohoku University's Space Robotics Lab (hereafter ``SRL"), under the guidance of Professor Kazuya Yoshida, among others. This laboratory focuses on the research and development of robotic systems for space exploration and science missions.

One of the major sub-groups within SRL is the Hakuto Lunar XPRIZE team, a group of engineers who, working together with their promotional counterparts in Tokyo, have been working for several years on the core mission of sending a lunar rover to the Moon, traveling at least 500 meters, and sending back high-resolution and photos. Completing this mission would satisfy the requirements of the Google Lunar XPRIZE, an international lunar rover competition with a combined purse of \$30M USD \cite{xprize}.

As a secondary mission, Hakuto hopes to explore the interior of caves on the Moon, as precursor exploration to assess their feasibility as future human habitats. Recent high-resolution photography from JAXA's Kaguya spacecraft, and from NASA's Lunar Reconnaissance Orbiter, has confirmed that large ``skylights" exist on the lunar surface leading into these caves \cite{rabbithole}, and Hakuto aims to land near enough to one of these skylights to make its exploration a possibility.

We decided that Hakuto's four-wheeled ``Moonraker" rover would be an excellent testbed against which to develop advanced fault analysis algorithms and visualization. Moonraker is a state-of-the-art micro-rover, developed over the past 5 years by the Hakuto team. During normal operation, Moonraker sends back status reports on 100 to 150 channels of telemetry data to its ground station on Earth, at a rate of once per second. This telemetry covers everything from IMU attitude data and temperature sensors readings to motor rotations, solar charge voltage, and communication metadata such as packets errors detected and radio signal strength.

See Figure~\ref{fig:moonraker} for a photo of Moonraker.

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/moonraker.jpg}
    \caption{Hakuto's Moonraker ``Pre-Flight Model 2." Photo by George Thomas Mendel.}
    \label{fig:moonraker}
\end{figure}

\section{Ground Station Interface}

After I joined Team Hakuto, we began designing a new ground station software suite for the most recent version of the rover. The rover had been updated in several ways since the prior Pre-Flight Model, and many of its avionics, including its software, were updated and redesigned, breaking compatibility with the previous version of the ground station software. We worked together to evaluate the current and future needs of the rover, and to redesign and reimplement software to optimally fit these needs.

Our discussions focused on optimizing performance, reliability, and maintainability of the software. The latter factor was of particular concern, given that the software was to be used and maintained in a university laboratory environment, with many students---some of them inexperienced in software engineering---potentially responsible for updating the software and adding new features. After evaluating a list of disparate choices, including C++ on Linux with the Qt framework and multi-platform JavaScript running in HTML5, we ultimately decided that the ideal choice would be the Unity Game Engine, for its high frequency of software updates, its active developer community, and its aerospace legacy within the NASA Jet Propulsion Laboratory \cite{jplunity}. 

\section{Rover Data Path}

In Hakuto's network configuration, Moonraker sends data packets over radio from the Moon, and they are intercepted on Earth and relayed to the ground station over the Internet. Subsequently, these packets are decoded and processed in order to be visualized by the ground station. The data is stored locally in memory by the ground station software for subsequent display. A flowchart of this data path is shown in Fig.~\ref{fig:data_path}.

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/rover_data_flow.png}
    \caption{Moonraker's communication flow, from rover subsystem to ground station data storage, is shown.}
    \label{fig:data)path}
\end{figure}

\subsection{Non-FDIR-Related Components}

The focus of this paper is on the fault detective and correlative visualizations implemented within the ground station, so we will spend the bulk of the time focusing on this component. However, there were several non-FDIR-related components as well, briefly described below to provide context:

\begin{itemize}
    \item \textit{Numerical telemetry display}, to visually show the state of various sensors on subsystem boards (such as IMU accelerations, motor voltages, and board temperatures), as well as internal software metrics. Whenever possible, telemetry data was placed in semantically meaningful positions and groups, to improve discoverability.
    \item \textit{Attitude display and visual tachometer}, to provide more intuitive visualizations of pitch, roll, and current wheel rotation rate (which mostly corresponded to vehicle speed).
    \item \textit{Telemetry change indicators}, to point out data channels that have strong downward or upward trends over time.
    \item \textit{Quad-camera display}, to display the most recent images and streaming video from the rover cameras.
    \item \textit{Connectivity map}, to show the state of connectivity to various subsystems based on the elapsed time since packets from those subsystems had been received.
    \item \textit{Immersive viewing}, allowing users to navigate the camera data in an embedded 3D mapping.
    \item \textit{Map display}, showing the position of the rover with respect to the surrounding selenography, based on mobility subsystem telemetry and SLAM telemetry.
    \item \textit{Audio alert cues}, to draw the user's attention to the UI in the event of faults.
    \item \textit{Telemetry saving, loading, and playback}, to facilitate the review of mission events after the fact.
\end{itemize}

\subsection{FDIR-Related Components}

In comparison with traditional aerospace ground station software, particular attention was given in this implementation to FDIR-related components. The components below were implemented and used extensively.

\subsubsection{Threshold-based fault detection}

In order to build a threshold-based fault detection system for Moonraker, I worked with engineers on our team to define the ``danger" thresholds that indicated points of severe jeopardy, as well as the ``warning" thresholds that indicated points of concern. I implemented these thresholds in my ground station software as a general-purpose fault detection engine. Faults are detected constantly, and are displayed to the user via color and detailed information (see the following sections for more details). All fault occurrence details and times are logged for future review as well. See Figure~\ref{fig:mobility_telem_subpanel}.

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/mobility_telem_subpanel.png}
    \caption{Various telemetry values are shown for the mobility subsystem. Colors indicate current fault detection levels, with green representing a nominal state.}
    \label{fig:mobility_telem_subpanel}
\end{figure}

\subsubsection{Fault alert panel}

For safety, faults that have occurred need to be easily visible and understood by human operators. Towards this end, a highly visible, brightly colored alert panel was placed at the top of the screen seen by human operators. Each panel cell corresponds to a subsystem or other type of data grouping, and any issues with that grouping (i.e., faults that occur on monitored channels) will trigger a color change on that cell. Interacting with the cell can give the user more information on the fault (see the next section for details). See Figure~\ref{fig:alert_panel}.

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/alert_panel.png}
    \caption{An alert panel monitors potential faults on various different subsystems, indicating any faults and their severity by color.}
    \label{fig:alert_panel}
\end{figure}

\subsubsection{Detailed fault information}

Ensuring human understanding of fault data is an essential part of the fault diagnosis and recovery process. As such, it's important to design a system where detailed information can be provided about individual faults that have occurred, while maintaining a high-level understanding of which systems are behaving anomalously. The system designed allows for this hierarchical organization of information. When high-level fault information is indicated in the ``fault alert panel," more concise information is provided in the ``fault information panel," including which anomalous data channels are contributing to the problem. The fault information is highly extensible, allowing for any other additional fault-related notes that system designers or operators would like to include for reference. This additional information, uncommon in traditional fault monitoring systems, accelerates the fault diagnosis problem by immediately pointing towards possible root causes. See Figure~\ref{fig:fault_info2}.

\begin{figure}[h]
\centering
    \includegraphics[width=0.4\columnwidth]{images/fault_info2.png}
    \caption{Information for monitored faults on a given subsystem.}
    \label{fig:fault_info2}
\end{figure}

\subsubsection{Correlative Functionality}

The Pearson Correlation Coefficient was chosen as an algorithm for calculating correlationbetween sets of data channels, in order to give a metric of their mutual ``connectedness." This algorithm was chosen for its simple and efficient calculations, under the (perhaps premature) assumption of linear relationships.

To visualize this data, a two-dimensional corrgram was used, visualizing relationships between data channels as a matrix with cell shadings representative of the PCC score of each relationship. Hue of each cell shows positive/negative correlation, and intensity shows the strength of that correlation. This visualization allows an operator can see changing channel correlations, which may suggest possible interconnectedness or causation and aid with troubleshooting. See Figure~\ref{fig:corr_map}.

To show the flow of this data, pseudocode for the algorithm used is shown below.

\begin{algorithm}
    \caption{Euclid's algorithm}\label{euclid}
    \begin{algorithmic}[1]
        \Procedure{Euclid}{$a,b$}\Comment{The g.c.d. of a and b}
        \State $r\gets a\bmod b$
        \While{$r\not=0$}\Comment{We have the answer if r is 0}
        \State $a\gets b$
        \State $b\gets r$
        \State $r\gets a\bmod b$
        \EndWhile\label{euclidendwhile}
        \State \textbf{return} $b$\Comment{The gcd is b}
        \EndProcedure
    \end{algorithmic}
\end{algorithm}


I also built functionality to adjust the sampling rate, the period of time over which samples are taken, and parameters related to averaging for smoothing out noise. Channel pairs may also be filtered via substring search.

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/corr_map.png}
    \caption{Correlation map visualization showing various different data channel pairs and their correlations. Bright orange signifies a high positive correlation, and bright blue is a high negative correlation.}
    \label{fig:corr_map}
\end{figure}





\section{Testing}

Hakuto carried out a number of field tests on the ground station software, including FDIR-related and correlative components. The major tests we conducted are described in detail below.

\subsection{Field Testing}

Over the course of two weeks, we performed daily field tests in the rock quarry, to both assess the physical characteristics of our radio communication and to confirm our mobility in a simulated lunar environment. (See Fig.~\ref{fig:night_test_team} for an image of the quarry terrain.) The ground station interface was in constant use throughout the course of the tests, with alternating drivers at the helm. The setup usually involved one primary pilot and one copilot, who helped with troubleshooting. See Fig.~\ref{fig:daytime_operation_pittsburgh_field_test} for an image of normal operation.

Our radio testing was multi-pronged. First, we endeavored to established that we could a) communicate from the ground station to Moonraker and vice-versa by going through Astrobotic's radio relay, which they set up to emulate their lunar lander which will function as a communication relay during the actual, planned lunar mission. Second, we tested the communication capabilities of Moonraker's radio antenna at two different operating frequencies (900 MHz and 2.4 GHz), in order to characterize performance over long distance and with line-of-sight blocked by rocky terrain. We looked for communication signal strength and commanding efficacy in the presence of packet loss, and also tested the effect of a signal strength amplifier in a poor connectivity situation. These results were promising and are currently being analyzed by our communications team.

Our mobility testing consisted of driving long distances over rocky, yet generally even, terrain, occasionally using only the near-real-time (``NRT") streaming video telemetry as visual feedback. We set up various challenges, such as large rock obstacles and inclines of increasing steepness, to test the rover's mobility capabilities as well as our operational capabilities using the ground station interface.

Other tasks performed during the field tests included coordinating with Hakuto crew and Astrobotic/Caltech engineers to fulfill mission tasks, scouting for field test locations, setting up and testing the ground station and radio equipment, and driving the rover during all of the tests to accomplish all of our test goals.

Results of this field test, and other similar ones, will be discussed in the next chapter.

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/daytime_operation_pittsburgh_field_test.jpg}
    \caption{Lead software engineer Toshiro Shimizu and the author work on radio testing during a Pittsburgh field test at the Lafarge rock quarry.}
    \label{fig:daytime_operation_pittsburgh_field_test}
\end{figure}

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/night_test_team.png}
    \caption{Engineering members of Team Hakuto discuss terrain challenges during a nighttime field test.}
    \label{fig:night_test_team}
\end{figure}

\subsection{Usability Testing}

In November 2015, I performed a set of usability tests on a slimmed-down version of the Moonraker ground station interface, in order to evaluate the various data analysis affordances and to determine any usability issues in need of attention. Seven users participated in the test, mostly interns and students possessing some familiarity with the rover, but with limited to no experience operating it via the ground station interface. See Fig.~\ref{fig:ui_test_takako} for an image of a user taking the test.

Participants were presented with a simplified form of the ground station, with the Pilot Screen, Copilot Screen, and the Correlation Map screen. As the correlation map is a relatively novel idea, and has not (to the best of the author's knowledge) ever been used in ground station software, this test also served to see if it could be immediately usable in its present state, or if special training or modifications will be necessary before the correlation map is useful for correlation discovery and root cause analysis.

\subsubsection{Test Tasks}

During the test, participants monitored telemetry and looked for patterns in received data during a ~10-minute simulation drive on the lunar surface. During the course of the drive, camera images were unavailable, but the rover telemetry was indicative of various events that occurred to the rover during the run. The scenario consisted of the rover descending down into a crater, where it loses direct sunlight, resulting in reduced temperatures and solar charge voltages. It also loses line of sight with the lunar lander, causing packet losses and a reduction in signal strength. The rover then climbs out of the crater, bringing about an all-around improvement in these conditions. It enters some rough terrain, and ultimately stops after a rock becomes stuck in the wheel.

It was the task of the usability test participants to analyze the telemetry as it was received in order to try to understand the details of the story above. After the 10-minute run was complete, users were then given up to an additional 10 minutes to review received telemetry until they were satisfied they had understood the ``story" of the rover's trip.

Results of usability testing will be discussed in the next chapter.

\begin{figure}[h]
\centering
    \includegraphics[width=\columnwidth]{images/ui_test_takuto.jpg}
    \caption{A usability test participant focuses on the incoming telemetry to try to ascertain patterns behind a faulted system.}
    \label{fig:ui_test_takuto}
\end{figure}